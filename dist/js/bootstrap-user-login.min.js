/*! bootstrap-user-login 2015-08-05 */
!function(a){"use strict";"function"==typeof define&&define.amd?define(["jquery"],a):window.jQuery&&a(window.jQuery)}(function(a){var b=function(b,c){this.form=b,this.opt=c,this.signinPanel=a(".user-signin-panel"),this.signoutPanel=a(".user-signout-panel"),b.on("submit",a.proxy(this.submit,this)),this.url=b.attr("action"),-1!==this.url.indexOf("verify")&&b.trigger("submit"),a(".user-signout-btn").on("click",a.proxy(this.doSignout,this)),a.get("/api/auth",a.proxy(this.signin,this))};b.prototype={constructor:b,signin:function(b){console.log(b),this.user=b.data,a(".user-name",this.signinPanel).text(this.user.name),this.signinPanel.removeClass("hidden"),this.signoutPanel.addClass("hidden"),this.form.trigger("signin",[b])},submit:function(b){var c=a(b.target);return a.ajax(a.extend({method:"POST",url:this.url,data:c.serialize(),success:a.proxy(this.success,this),skipAjaxControl:!!c.data().skipAjaxControl},this.opt)),!1},doSignout:function(){a.get("/api/auth/signout",a.proxy(this.signout,this))},signout:function(){this.signinPanel.addClass("hidden"),this.signoutPanel.removeClass("hidden"),delete this.user},success:function(b){-1!==this.url.indexOf("signin")?window.location.href="/":-1!==this.url.indexOf("forgot")?a(".alert-success").removeClass("hidden"):-1!==this.url.indexOf("verify")&&1===b.code}},a.fn.userlogin=function(c){var d=arguments;return this.each(function(){var e=a(this),f=e.data("userlogin"),g="object"==typeof c?c:{};f||"string"==typeof c?"string"==typeof c&&f[c].apply(f,Array.prototype.slice.call(d,1)):e.data("userlogin",new b(e,g))})};var c=a('<div class="user-message hidden"><div style="padding: 5px;"><div class="alert alert-danger .alert-dismissible user-inner-message"><button type="button" class="close" aria-label="Close">&times;</button><p></p></div></div></div>');a.ajaxControl=function(b){var d=!1;if(1===b.code)d=!0;else if(0===b.code);else{c.removeClass("hidden");var e=null;a.userMsg&&(e=a.userMsg[b.code]),a("p",c).text(e||b.code)}return d},a(".close",c).on("click",function(){c.addClass("hidden")}),a("body").append(c),a(document).ajaxError(function(b,d,e,f){a("p",c).text(f),c.removeClass("hidden")}).ajaxSend(function(){c.addClass("hidden"),a("button[type=submit]").button("loading")}).ajaxComplete(function(){a("button[type=submit]").button("reset")})});